(()=>{document.addEventListener("DOMContentLoaded",()=>{let g=new ethers.providers.Web3Provider(window.ethereum),u=new ethers.Contract(config.sepolia.contractAddress,config.abi,g),p=g.getSigner(),h=u.connect(p),i=[{name:"",variations:[],selected:0},{name:"",variations:[],selected:0},{name:"",variations:[],selected:0}],m={url:"",metadata:""};async function f(){try{let e=await(await fetch("https://aifn-1-api.vercel.app/api/generate-background")).json();m.url=e.imageUrl,m.metadata=e.metadata,document.getElementById("background-image").src=m.url,document.getElementById("preview-background").src=m.url,document.getElementById("background-metadata").innerText=m.metadata}catch(t){document.getElementById("status").innerText=`Error fetching background: ${t.message}`}}f();async function I(){try{let t=await u.mintFee();document.getElementById("mintFeeDisplay").innerText=`Mint Fee: ${ethers.utils.formatEther(t)} ETH`}catch(t){document.getElementById("mintFeeDisplay").innerText=`Mint Fee: Error - ${t.message}`}}I();for(let t=1;t<=3;t++){let e=t-1,n=document.getElementById(`trait${t}-name`),r=document.getElementById(`trait${t}-files`),o=document.getElementById(`trait${t}-grid`);r.addEventListener("change",async c=>{let l=Array.from(c.target.files).sort((d,a)=>d.name.localeCompare(a.name));if(!l.length)return;let y=n.value.trim()||`Trait ${t}`;i[e].name=y,i[e].variations=[],o.innerHTML="";for(let d of l){let a=d.name.split(".").slice(0,-1).join("."),E=URL.createObjectURL(d);i[e].variations.push({name:a,url:E});let s=document.createElement("img");s.src=E,s.alt=a,s.className="variation",s.style.width="100px",s.style.height="100px",s.style.objectFit="contain",s.addEventListener("click",()=>v(e,a)),o.appendChild(s)}i[e].variations.length>0&&v(e,i[e].variations[0].name),w()})}function v(t,e){let n=i[t],r=n.variations.findIndex(c=>c.name===e);n.selected=r;let o=document.getElementById(`trait${t+1}-grid`);Array.from(o.children).forEach((c,l)=>{c.classList.toggle("selected",l===r)}),document.getElementById(`preview-trait${t+1}`).src=n.variations[r].url}document.getElementById("test-background").addEventListener("click",f);function w(){let t=i.every(n=>n.name&&n.variations.length>0),e=document.getElementById("mintButton");e.disabled=!t}window.mintNFT=async function(){let t=document.getElementById("status");try{await g.send("eth_requestAccounts",[]);let e=i.length,n=i.map(a=>a.variations.length),r=i.map(a=>a.selected),o=await p.getAddress();t.innerText="Estimating gas...";let c=await h.estimateGas.mintNFT(o,initialHtmlUri,e,n,r,{value:ethers.utils.parseEther(sepolia.mintFee)});t.innerText="Minting...";let d=(await(await h.mintNFT(o,initialHtmlUri,e,n,r,{value:ethers.utils.parseEther(sepolia.mintFee),gasLimit:c.add(5e4)})).wait()).events.find(a=>a.event==="Transfer").args.tokenId.toString();t.innerText=`Minted! Token ID: ${d}`}catch(e){t.innerText=`Error: ${e.message}`}}});})();
