(()=>{document.addEventListener("DOMContentLoaded",()=>{let p=new ethers.providers.Web3Provider(window.ethereum),f=new ethers.Contract(config.sepolia.contractAddress,config.abi,p),v=p.getSigner(),y=f.connect(v),n=[{name:"",variations:[],selected:0},{name:"",variations:[],selected:0},{name:"",variations:[],selected:0}],m={url:"",metadata:""};async function E(){try{let e=await(await fetch("https://aifn-1-api.vercel.app/api/generate-background")).json();m.url=e.imageUrl,m.metadata=e.metadata,document.getElementById("background-image").src=m.url,document.getElementById("preview-background").src=m.url,document.getElementById("background-metadata").innerText=m.metadata}catch(t){document.getElementById("status").innerText=`Error fetching background: ${t.message}`}}E();async function I(){try{let t=await f.mintFee();document.getElementById("mintFeeDisplay").innerText=`Mint Fee: ${ethers.utils.formatEther(t)} ETH`}catch(t){document.getElementById("mintFeeDisplay").innerText=`Mint Fee: Error - ${t.message}`}}I();for(let t=1;t<=3;t++){let e=t-1,a=document.getElementById(`trait${t}-name`),s=document.getElementById(`trait${t}-files`),c=document.getElementById(`trait${t}-grid`);s.addEventListener("change",async o=>{let l=Array.from(o.target.files).sort((d,i)=>d.name.localeCompare(i.name));if(!l.length)return;let u=a.value.trim()||`Trait ${t}`;n[e].name=u,n[e].variations=[],c.innerHTML="";for(let d of l){let i=d.name.split(".").slice(0,-1).join("."),h=URL.createObjectURL(d);n[e].variations.push({name:i,url:h});let r=document.createElement("img");r.src=h,r.alt=i,r.className="variation",r.style.width="100px",r.style.height="100px",r.style.objectFit="contain",r.addEventListener("click",()=>w(e,i)),c.appendChild(r)}n[e].variations.length>0&&w(e,n[e].variations[0].name),T()})}function w(t,e){let a=n[t],s=a.variations.findIndex(o=>o.name===e);a.selected=s;let c=document.getElementById(`trait${t+1}-grid`);Array.from(c.children).forEach((o,l)=>{o.classList.toggle("selected",l===s)}),document.getElementById(`preview-trait${t+1}`).src=a.variations[s].url}document.getElementById("test-background").addEventListener("click",E);function T(){let t=n.every(a=>a.name&&a.variations.length>0),e=document.getElementById("mintButton");e.disabled=!t}window.mintNFT=async function(){let t=document.getElementById("status");try{await p.send("eth_requestAccounts",[]);let e=n.length,a=n.map(g=>g.variations.length),s=n.map(g=>g.selected),c=await v.getAddress();t.innerText="Uploading images to Arweave...";let o=new FormData;for(let g=0;g<n.length;g++){let B=n[g],b=B.variations[B.selected],k=await(await fetch(b.url)).blob();o.append("images",k,`${B.name}-${b.name}.png`)}let u=await(await fetch("https://aifn-1-api.vercel.app/api/upload-to-arweave",{method:"POST",body:o})).json();if(u.error)throw new Error(u.error);let d=u.transactionIds.map(g=>`https://arweave.net/${g}`);t.innerText="Estimating gas...";let i=await y.estimateGas.mintNFT(c,initialHtmlUri,e,a,s,{value:ethers.utils.parseEther(sepolia.mintFee)});t.innerText="Minting...";let x=(await(await y.mintNFT(c,initialHtmlUri,e,a,s,{value:ethers.utils.parseEther(sepolia.mintFee),gasLimit:i.add(5e4)})).wait()).events.find(g=>g.event==="Transfer").args.tokenId.toString();t.innerText=`Minted! Token ID: ${x}`}catch(e){t.innerText=`Error: ${e.message}`}}});document.addEventListener("DOMContentLoaded",()=>{let p=new ethers.providers.Web3Provider(window.ethereum),f=new ethers.Contract(config.sepolia.contractAddress,config.abi,p),v=p.getSigner(),y=f.connect(v),n=[{name:"",variations:[],selected:0},{name:"",variations:[],selected:0},{name:"",variations:[],selected:0}],m={url:"",metadata:""};async function E(){try{let e=await(await fetch("https://aifn-1-api.vercel.app/api/generate-background")).json();m.url=e.imageUrl,m.metadata=e.metadata,document.getElementById("background-image").src=m.url,document.getElementById("preview-background").src=m.url,document.getElementById("background-metadata").innerText=m.metadata}catch(t){document.getElementById("status").innerText=`Error fetching background: ${t.message}`}}E();async function I(){try{let t=await f.mintFee();document.getElementById("mintFeeDisplay").innerText=`Mint Fee: ${ethers.utils.formatEther(t)} ETH`}catch(t){document.getElementById("mintFeeDisplay").innerText=`Mint Fee: Error - ${t.message}`}}I();for(let t=1;t<=3;t++){let e=t-1,a=document.getElementById(`trait${t}-name`),s=document.getElementById(`trait${t}-files`),c=document.getElementById(`trait${t}-grid`);s.addEventListener("change",async o=>{let l=Array.from(o.target.files).sort((d,i)=>d.name.localeCompare(i.name));if(!l.length)return;let u=a.value.trim()||`Trait ${t}`;n[e].name=u,n[e].variations=[],c.innerHTML="";for(let d of l){let i=d.name.split(".").slice(0,-1).join("."),h=URL.createObjectURL(d);n[e].variations.push({name:i,url:h});let r=document.createElement("img");r.src=h,r.alt=i,r.className="variation",r.style.width="100px",r.style.height="100px",r.style.objectFit="contain",r.addEventListener("click",()=>w(e,i)),c.appendChild(r)}n[e].variations.length>0&&w(e,n[e].variations[0].name),T()})}function w(t,e){let a=n[t],s=a.variations.findIndex(o=>o.name===e);a.selected=s;let c=document.getElementById(`trait${t+1}-grid`);Array.from(c.children).forEach((o,l)=>{o.classList.toggle("selected",l===s)}),document.getElementById(`preview-trait${t+1}`).src=a.variations[s].url}document.getElementById("test-background").addEventListener("click",E);function T(){let t=n.every(a=>a.name&&a.variations.length>0),e=document.getElementById("mintButton");e.disabled=!t}window.mintNFT=async function(){let t=document.getElementById("status");try{await p.send("eth_requestAccounts",[]);let e=n.length,a=n.map(i=>i.variations.length),s=n.map(i=>i.selected),c=await v.getAddress();t.innerText="Estimating gas...";let o=await y.estimateGas.mintNFT(c,initialHtmlUri,e,a,s,{value:ethers.utils.parseEther(sepolia.mintFee)});t.innerText="Minting...";let d=(await(await y.mintNFT(c,initialHtmlUri,e,a,s,{value:ethers.utils.parseEther(sepolia.mintFee),gasLimit:o.add(5e4)})).wait()).events.find(i=>i.event==="Transfer").args.tokenId.toString();t.innerText=`Minted! Token ID: ${d}`}catch(e){t.innerText=`Error: ${e.message}`}}});})();
